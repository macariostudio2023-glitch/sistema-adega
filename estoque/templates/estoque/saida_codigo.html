{% extends "estoque/base.html" %}

{% block title %}SaÃ­da/Venda - Sistema Adega{% endblock %}

{% block content %}
<div class="centered-card" style="max-width: 500px; margin: 20px auto; padding: 20px; background: #111827; color: white; border-radius: 12px;">

  <h2 style="text-align:center; color: #ef4444;">ðŸ›’ SaÃ­da (Venda)</h2>
  <p style="text-align:center; margin-top:6px; font-size: 0.9em; opacity: 0.8;">
    {% if produto %} CONFIRME A QUANTIDADE {% else %} APONTE O LEITOR PARA VENDER {% endif %}
  </p>

  {% if messages %}
    <ul style="list-style:none; padding:0; margin:12px 0;">
      {% for message in messages %}
        <li style="margin-bottom:8px; padding:10px; border-radius:10px; font-weight:bold; text-align:center; background:{% if message.tags == 'error' %}rgba(239,68,68,.25){% else %}rgba(34,197,94,.25){% endif %};">
          {{ message }}
        </li>
      {% endfor %}
    </ul>
  {% endif %}

  <form method="post" id="saidaForm">
    {% csrf_token %}

    <label style="display:block; text-align:left; margin-bottom: 5px;">CÃ³digo de barras</label>
    <div style="display: flex; gap: 5px;">
        <input type="text" name="codigo_barras" id="id_codigo_barras" 
               required autofocus 
               value="{{ codigo|default:'' }}"
               style="flex-grow: 1; padding: 12px; border-radius: 8px; border: 1px solid #374151; background: #1f2937; color: white;">
        
        <button type="submit" name="acao" value="buscar" style="width: 50px; background: #4b5563; border: none; border-radius: 8px; color: white; cursor: pointer;">ðŸ”Ž</button>
    </div>

    {% if produto %}
    <div style="margin-top: 20px; padding: 15px; border-radius: 12px; background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444;">
        <h3 style="margin: 0; color: #f87171;">{{ produto.nome }}</h3>
        <p style="margin: 5px 0; opacity: 0.8;">Estoque atual: <strong>{{ produto.estoque_atual }}</strong></p>
        <p style="margin: 5px 0; color: #34d399;">PreÃ§o UnitÃ¡rio: <strong>R$ <span id="preco_un_val">{{ produto.preco_venda }}</span></strong></p>
        
        <label style="text-align:left; margin-top: 10px; display: block;">Quantidade a vender</label>
        <input type="number" name="quantidade" id="id_quantidade" value="1" min="1" max="{{ produto.estoque_atual }}"
               style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #374151; background: #1f2937; color: white; font-size: 1.2em;">

        <div style="margin-top: 15px; padding: 15px; background: #065f46; border-radius: 8px; text-align: center; border: 2px solid #34d399;">
            <span style="display:block; font-size: 0.9em; text-transform: uppercase;">Total da Venda</span>
            <strong style="font-size: 1.8em;">R$ <span id="total_venda">0,00</span></strong>
        </div>

        <button type="submit" name="acao" value="salvar" 
                style="margin-top: 15px; width: 100%; padding: 15px; font-size: 1.1em; background: #ef4444; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer;">
            ðŸš€ CONFIRMAR VENDA
        </button>
        
        <a href="{% url 'saida_codigo' %}" style="display:block; text-align:center; margin-top:10px; color:#9ca3af; text-decoration:none; font-size:0.9em;">Cancelar</a>
    </div>
    {% else %}
    <button type="submit" name="acao